<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title> PyNET Project </title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,700italic,400italic" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <script src="js/modernizr.js"></script>
    <meta name="viewport" content="width=device-width">

    <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	  ga('create', 'UA-105303874-1', 'auto');
	  ga('send', 'pageview');
    </script>
</head>

<!--
<button id="demo-button" class="online-demo" onclick="open_demo();"><img src="assets/img/demo_button2.png"></button> 

<div id="demos" style="display:none">
	<a href="#" style="position: fixed; right: 2.2vmax; top: 6.3vw; color: white; z-index:9999; text-decoration: none; font-size: 1.2vmax;" onclick="close_demo()"> &#10006; </a>
	<iframe class="demo" src="http://quality-gpu.eastus.cloudapp.azure.com:8080" name="targetframe" allowTransparency="true" scrolling="yes" frameborder="0" >
	<!--<iframe class="demo" src="http://127.0.0.1:5000/" name="targetframe" allowTransparency="true" scrolling="yes" frameborder="0" >
	</iframe>
</div>
-->

<body data-spy="scroll" data-offset="0" data-target="#navbar-main">

<!-- ==== MENU ==== -->

<nav>
	<ul class="left_bar">
		<a href="index.html"> <li2> DPED </li2></a>
		<a href="wespe.html"> <li2> WESPE </li2></a>
		<a href="pynet.html"> <li2 style="background-color: rgba(233,79,112, 0.85);"> PyNET </li2></a>
		<a href="pynet-bokeh.html"> <li2> Bokeh </li2></a>
		<a href="microisp.html"> <li2> MicroISP </li2></a>
		<a href="camsdd.html"> <li2> CamSDD </li2></a>
		<a href="midd.html"> <li2> MIDD </li2></a>
	</ul>
	<ul class="middle_bar">
		<a href="#title"> <li> PAPER </li></a>
		<a href="#demo"> <li> DEMO </li></a>
		<a href="#dataset"> <li> DATASET </li></a>
		<a href="#algo"> <li> ALGO </li></a>
		<a href="#code"> <li> CODE </li></a>
	</ul>
	<ul class="right_bar">
		<a target="_blank" href="http://www.vision.ee.ethz.ch/en/" > <li> <img src="assets/img/eth_logo.png"> </li></a>
		<a href="#about"> <li> ABOUT </li></a>
	</ul>
</nav>

<div id="title">
<h1 class="title"> Replacing Mobile Camera ISP with a Single Deep Learning Model </h1>

<table class="authors-pynet">
<tr>
	<td><a target="_blank" class = "link-invisible" href="https://linkedin.com/in/andrey-ignatov">Andrey Ignatov</a></td>
	<td><a target="_blank" class = "link-invisible" href="https://insait.ai/prof-luc-van-gool/">Luc Van Gool</a></td>
	<td><a target="_blank" class = "link-invisible" href="https://cvlai.net/">Radu Timofte</a></td>
</tr>
<tr class="emails">
	<td>ihnatova@ethz.ch</td>
	<td>vangool@vision.ee.ethz.ch</td>
	<td>radu.timofte@uni-wuerzburg.de</td>
</tr>
</td>
</table>

</div>

<div id="abstract">
	<div>
		<div class="title-arxiv-pynet">
	       	<p><a target="_blank" href="https://arxiv.org/pdf/2002.05509.pdf"><img src="assets/img/pynet/pynet_arxiv.png" width="100%"></a></p>
	    </div>
		<div class="title-info-pynet">
	    	<p> <span style="font-weight:bold">Abstract:</span> As the popularity of mobile photography is growing constantly, lots of efforts are being invested now into building complex hand-crafted camera ISP solutions. In this work, we demonstrate that even the most sophisticated ISP pipelines can be replaced with a single end-to-end deep learning model trained without any prior knowledge about the sensor and optics used in a particular device. For this, we present PyNET, a novel pyramidal CNN architecture designed for fine-grained image restoration that implicitly learns to perform all ISP steps such as image demosaicing, denoising, white balancing, color and contrast correction, demoireing, etc. The model is trained to convert RAW Bayer data obtained directly from mobile camera sensor into photos captured with a professional high-end DSLR camera, making the solution independent of any particular mobile ISP implementation. To validate the proposed approach on the real data, we collected a large-scale dataset consisting of 10K full-resolution RAW-RGB image pairs captured in the wild with the Huawei P20 cameraphone (12.3 MP Sony Exmor IMX380 sensor) and Canon 5D Mark IV DSLR. The experiments demonstrate that the proposed solution can easily get to the level of the embedded P20's ISP pipeline that, unlike our approach, is combining the data from two (RGB + B/W) camera sensors. The dataset, pre-trained models and codes used in this paper are provided below.</p>
	        <p style="margin-top: 0.2vw;">
	        	<a target="_blank" href="https://arxiv.org/pdf/2002.05509.pdf"> arXiv: 2002.05509, 2020 </a>
	        	<a target="_blank" href="https://arxiv.org/pdf/1910.06663.pdf"><button class="follow-up"> Deep Learning on Smartphones Paper >> </button></a>
	        	<!--<a target="_blank" href="http://phancer.com/"><button class="follow-up" style="padding-left: 2.9vw; padding-right: 2.9vw; background-color: #f16b59;"> online demo </button></a>-->
	        </p>
		</div>
	</div>
</div>

<div id="demo">

	<h1 class="title" style="font-size: 1.4vw;">
		Huawei P20:&nbsp;&nbsp; <text class="highlight-color-blue">RAW Photos</text>&nbsp; vs. &nbsp;<text class="highlight-color">Reconstructed with PyNET</text>
	</h1>
	
		<!-- Huawei P20 Images -->

	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/1.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/1.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/2.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/2.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>


	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/3.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/3.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/4.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/4.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	
	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/5.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/5.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/6.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/6.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/7.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/7.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	<figure class="cd-image-container">
		<img src="demo_pynet/p20/raw/8.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/8.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<!-- Huawei P20 Images -->
	
	<p>
	</br>
	</p>
	
	<h1 class="title" style="font-size: 1.4vw;">
		Huawei P20:&nbsp;&nbsp; <text class="highlight-color-blue">Huawei ISP Photos</text>&nbsp; vs. &nbsp;<text class="highlight-color">Reconstructed with PyNET</text>
	</h1>


	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/1.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/1.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/2.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/2.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>


	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/3.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/3.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/4.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/4.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	
	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/5.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/5.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/6.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/6.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/7.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/7.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	<figure class="cd-image-container">
		<img src="demo_pynet/p20/isp/8.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">Huawei-ISP</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/p20/processed/8.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	<!-- BlackBerry KeyOne Images -->

	<p>
	</br>
	</p>

	<h1 class="title">
		BlackBerry KeyOne:&nbsp;&nbsp; <text class="highlight-color-blue">RAW Photos</text>&nbsp; vs. &nbsp;<text class="highlight-color">Reconstructed with PyNET</text>
	</h1>

	<figure class="cd-image-container">
		<img src="demo_pynet/keyone/raw/1.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/keyone/processed/1.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/keyone/raw/2.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/keyone/processed/2.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	<figure class="cd-image-container">
		<img src="demo_pynet/keyone/raw/3.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/keyone/processed/3.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>


	<figure class="cd-image-container">
		<img src="demo_pynet/keyone/raw/4.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/keyone/processed/4.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
	<figure class="cd-image-container">
		<img src="demo_pynet/keyone/raw/5.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/keyone/processed/5.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>

	<figure class="cd-image-container">
		<img src="demo_pynet/keyone/raw/6.jpg" alt="Original Image">
		<span class="cd-image-label" data-type="original">RAW</span>
		
		<div class="cd-resize-img">
			<img src="demo_pynet/keyone/processed/6.jpg" alt="Modified Image">
			<span class="cd-image-label" data-type="modified">PyNET</span>
		</div>
		
		<span class="cd-handle cd-first"></span>
	</figure>
	
</div>

<div id="dataset">

	<h1 class="title"> Zurich RAW to RGB Dataset </h1>

	<div>
		<div class="zrr-image">
	       	<p><img src="assets/img/pynet/ZRR_dataset.jpg" width="100%"></p>
	    </div>
		<div class="zrr-info">
	    	<p> To get real data for RAW to RGB mapping problem, a large-scale dataset consisting of 20 thousand photos was collected using <a target="_blank" class="grey-link" href="https://www.gsmarena.com/huawei_p20-9107.php">Huawei P20 smartphone</a> capturing RAW photos (plus the resulting RGB images obtained with Huawei's built-in ISP), and a professional high-end <a target="_blank" class="grey-link" href="https://en.wikipedia.org/wiki/Canon_EOS_5D_Mark_IV">Canon 5D Mark IV camera</a> with Canon EF 24mm f/1.4L fast lens. RAW data was read from P20's 12.3 MP Sony Exmor IMX380 Bayer camera sensor - though this phone has a second 20 MP monochrome camera, it is only used by Huawei's internal ISP system, and the corresponding images cannot be retrieved with any public camera API. The photos were captured in automatic mode, and default settings were used throughout the whole collection procedure. The data was collected over several weeks in a variety of places and in various illumination and weather conditions.
	    	</p>
	    	<br/>
	    	<br/>
			<p>
	    	Since the captured RAW-RGB image pairs are not perfectly aligned, they were first aligned globally using SIFT keypoints and RANSAC algorithm. Then, smaller patches of size 448&#215;448 were extracted from the preliminary matched images using a non-overlapping sliding window. Two windows were moving in parallel along the two images from each RAW-RGB pair, and the position of the window on DSLR image was additionally adjusted with small shifts and rotations to maximize the cross-correlation between the observed patches. Patches with cross-correlation less than 0.9 were not included into the dataset to avoid large displacements. This procedure resulted in <text class="highlight-color">48043 RAW-RGB image pairs</text> (of size 448&#215;448&#215;1 and 448&#215;448&#215;3, respectively) that were later used for training, validation and testing the models. RAW image patches were additionally reshaped into the size of 224&#215;224&#215;4, where the four channels correspond to the four colors of the RGBG Bayer filer.
			</p>
	    	<br/>
	    	<br/>
			<p>
			It should be mentioned that all alignment operations were performed only on RGB DSLR images, therefore RAW photos from Huawei P20 remained unmodified, containing the same values as were obtained from the camera sensor.
			</p>
			<br/>
			<br/>
			
			<!--a target="_blank" href="https://forms.gle/AG59ntXsZkT2ARaVA"><button class="zrr-btn-download">Download Zurich RAW to RGB Dataset (22 GB)</button></a-->
			<a target="_blank" href="https://download.ai-benchmark.com/s/GsfikXymMKHxCwr/download/Zurich-RAW-to-DSLR-Dataset.zip"><button class="zrr-btn-download">Download Zurich RAW to RGB Dataset (22 GB)</button></a>
		</div>
	</div>
	

</div>

<div id="algo">

	<h1 class="title"> PyNET Architecture </h1>
	
		<div class="pynet-architecture-info">
			<p>
			PyNET model has an inverted pyramidal shape and is processing the images at <text class="highlight-color">five different scales</text>. The proposed architecture has a number of blocks that are processing feature maps in parallel with convolutional filters of different size (from 3&#215;3 to 9&#215;9), and the outputs of the corresponding convolutional layers are then concatenated, which allows the network to learn a more diverse set of features at each level. The outputs obtained at lower scales are upsampled with transposed convolutional layers, stacked with feature maps from the upper level and then subsequently processed in the following convolutional layers. <text class="italic">Leaky ReLU</text> activation function is applied after each convolutional operation, except for the output layers that are using <text class="italic">Tanh</text> function to map the results to (-1, 1) interval. Instance normalization is used in all convolutional layers that are processing images at lower scales (levels 2-5).
			</p>
			<br/>
			<br/>
			<p>
			The model <text class="highlight-color">is trained sequentially</text>, starting from the lowest layer. This allows to achieve good image reconstruction results at smaller scales that are working with images of very low resolution and performing mostly global image manipulations. After the bottom layer is pre-trained, the same procedure is applied to the next level till the training is done on the original resolution. Since each higher level is getting upscaled high-quality features from the lower part of the model, it mainly learns to reconstruct the missing low-level details and refines the results. Note that the input layer is always the same and is getting images of size 224&#215;224&#215;4, though only a part of the training graph (all layers participating in producing the outputs at the corresponding scale) is trained.
			</p>
		</div>
		<div class="pynet-architecture-image">
	       	<p><img src="assets/img/pynet/architecture_pynet.png" width="100%"></p>
	    </div>

</div>

<div id="code">
	<h1 class="title"> <text class="highlight-color-blue">&#60;</text> Code <text class="highlight-color-blue">&#62;</text> </h1>
	<p><text class="highlight-color-blue">TensorFlow</text> PyNET implementation and the entire training pipeline is available in our <a target="_blank" class="grey-link" href="https://github.com/aiff22/PyNET">github repository</a></p>
	<br/>
	<p><text class="highlight-color-blue">PyTorch</text> implementation and pre-trained models can be found <a target="_blank" class="grey-link" href="https://github.com/aiff22/PyNET-PyTorch">here</a></p>
</div>

<div id="cite">
		<h1 class="title"> Citation </h1>
		
		<p><text class="italic">Andrey Ignatov, Luc Van Gool </text> and <text class="italic">Radu Timofte.</text></p>
		<p>"Replacing Mobile Camera ISP with a Single Deep Learning Model",</p>
		<p><text class="italic">Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR) Workshops</text>, 2020</p>
		<!--<br/>
		<br/>
		<br/>
		<p><text class="small-text">The work is supported by the ETH Zurich General Fund, Toyota via the project TRACE-Zurich, and an NVidia GPU grant.</text></p>-->

</div>

<div id="about">
	<div id="content">
		<!--<p>Contact: {ihnatova, nk, timofter, vanhoey}@vision.ee.ethz.ch</p>-->
		<p>ETH Zurich</p>
		<p>Switzerland, 2020-2025</p>
	</div>
</div>

<script src="js/jquery-2.1.1.js"></script>
<script src="js/jquery.mobile.custom.min.js"></script>
<script src="js/main.js"></script>
<script>
	function open_demo() {
		document.getElementById('demos').style.display="block";
		document.getElementById('demo-button').style.display="none";
	}
	function close_demo() {
		document.getElementById('demos').style.display="none";
		document.getElementById('demo-button').style.display="block";
	}
</script>
</body>

</html>
